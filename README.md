# GameLobbyApp

P2P通信を行うにはクライアント同士が通信相手のIPとポート番号(以下この対をIPEndPoint)を把握している必要があります。

このレポジトリはゲームクライアント同士でIPを交換するためのロビーサーバーを提供します。
これ自体にゲームロジックの同期機能はありません。

このサーバーの機能は
- 部屋作成機能
- 部屋参加機能

を持ちます。

クライアントは
1. このサーバーの部屋に参加し
2. 同じ部屋に別クライアントが接続するのを待ち
3. ゲーム開始のタイミングで自身のIPEndPointを登録し
4. 他のクライアントのIPEndpointが揃ったタイミングでIPEndPointをサーバーから取得する、

という流れを想定しています。

# IPEndPoint登録とNAT越え

クライアントがサーバーに登録する自身のIPEndPointを取得する機能はこのサーバーに含まれません。

IPアドレスにはプライベートとグローバルIPアドレスが存在し、プライベートIPアドレスはルーターを経由する際にNAPTと呼ばれる変換表によって1つのグローバルIPアドレスの異なるIPアドレスに変換されます。(e.g. 192.168.0.1:5000 -> xxx.xxx.xxx.xxx:51212)

上記のグローバルIPアドレス、ポート番号はルーターによって動的に割り振られるため、ほぼ一致することはありません。また一定の間隔で通信がない場合、動的に解放されるためIPEndPointの登録とクライアントとの通信の開始は速やかに行い、タイムアウトしないよう継続する必要があります(ここはリアルタイムゲームなら1秒に複数回通信するため問題にならないと思います)。

変換された後のxxx.xxx...のグローバルIPアドレス、ポート番号が別クライアントから見た際の入口になるので、このIPを取得する手段(STUNなど)が必要となります。
STUNは通信に用いるポートを使用してサーバーに接続し、そのポートを使った場合のグローバルIPEndPointを教えてもらう仕組みです。
それによって得られたグローバルIPアドレスをゲーム開始時に登録してください。